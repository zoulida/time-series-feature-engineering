# æ—¶åºç‰¹å¾å·¥ç¨‹ - æºä»£ç ç›®å½•

æœ¬ç›®å½•åŒ…å«æ—¶åºç‰¹å¾å·¥ç¨‹é¡¹ç›®çš„æ‰€æœ‰æºä»£ç ã€æ•°æ®å’Œç»“æœæ–‡ä»¶ã€‚

## ğŸ“ æ–‡ä»¶è¯´æ˜

### ğŸ”§ ç¨‹åºæ–‡ä»¶

| æ–‡ä»¶å | åŠŸèƒ½æè¿° |
|--------|----------|
| `prepare_tsfresh_input.py` | æ•°æ®é¢„å¤„ç†è„šæœ¬ï¼Œå°†å¤šè‚¡ç¥¨CSVæ•´ç†ä¸ºtsfreshé•¿è¡¨æ ¼å¼ |
| `run_factor_ic.py` | å› å­æå–ä¸ICè®¡ç®—ä¸»è„šæœ¬ï¼Œæ„å»ºæ»šåŠ¨çª—å£å¹¶è®¡ç®—ICè¯„åˆ† |
| `tsfresh_ic_analysis.py` | ICåˆ†ææ ¸å¿ƒç¨‹åºï¼ŒåŒ…å«ç‰¹å¾é‡è¦æ€§è®¡ç®—å’Œå¯è§†åŒ– |
| `enhanced_feature_extractor.py` | å¢å¼ºç‰ˆç‰¹å¾æå–å™¨ï¼Œä¸ä¾èµ–GPU/CUDA |
| `data_relationship_example.py` | æ•°æ®å…³ç³»ç¤ºä¾‹ï¼Œå±•ç¤ºtime_series_dfä¸target_dfçš„å…³ç³» |

### ğŸ“Š æ•°æ®æ–‡ä»¶

| æ–‡ä»¶å | æè¿° |
|--------|------|
| `000001.SZ.csv` | ç¤ºä¾‹è‚¡ç¥¨æ•°æ®ï¼ˆå¹³å®‰é“¶è¡Œï¼‰ |
| `tsfresh_long.csv` | å¤„ç†åçš„é•¿è¡¨æ•°æ®ï¼Œæ ¼å¼ï¼š[id,time,value] |
| `tsfresh_target_panel.csv` | ç›®æ ‡å˜é‡é¢æ¿æ•°æ®ï¼Œæ ¼å¼ï¼š[id,time,target] |
| `window_features.csv` | æ»šåŠ¨çª—å£ç‰¹å¾çŸ©é˜µ |

### ğŸ“ˆ ç»“æœæ–‡ä»¶

| æ–‡ä»¶å | æè¿° |
|--------|------|
| `ic_scores.csv` | ICè¯„åˆ†ç»“æœï¼ŒåŒ…å«å„ç‰¹å¾çš„ç›¸å…³ç³»æ•° |
| `feature_importance_report.txt` | ç‰¹å¾é‡è¦æ€§è¯¦ç»†æŠ¥å‘Š |
| `window_feature_ic_report.txt` | çª—å£ç‰¹å¾ICåˆ†ææŠ¥å‘Š |

### ğŸ¨ å¯è§†åŒ–æ–‡ä»¶

| æ–‡ä»¶å | æè¿° |
|--------|------|
| `ic_analysis_results.png` | ICåˆ†æç»“æœå¯è§†åŒ–å›¾è¡¨ |
| `data_relationship.png` | æ•°æ®å…³ç³»ç¤ºä¾‹å›¾è¡¨ |

### âš™ï¸ é…ç½®æ–‡ä»¶

| æ–‡ä»¶å | æè¿° |
|--------|------|
| `requirements.txt` | å®Œæ•´ä¾èµ–åŒ…åˆ—è¡¨ |
| `requirements_simple.txt` | ç®€åŒ–ä¾èµ–åŒ…åˆ—è¡¨ï¼ˆæ¨èï¼‰ |

## ğŸš€ ä½¿ç”¨æµç¨‹

### æ­¥éª¤1ï¼šç¯å¢ƒå‡†å¤‡
```bash
# æ¿€æ´»è™šæ‹Ÿç¯å¢ƒï¼ˆåœ¨é¡¹ç›®æ ¹ç›®å½•ï¼‰
.\venv\Scripts\Activate.ps1

# è¿›å…¥ç¨‹åºæ–‡ä»¶ç›®å½•
cd source/ç¨‹åºæ–‡ä»¶

# å®‰è£…ä¾èµ–
pip install -r ../é…ç½®æ–‡ä»¶/requirements_simple.txt
```

### æ­¥éª¤2ï¼šæ•°æ®é¢„å¤„ç†
```bash
# å¤„ç†Aè‚¡æ•°æ®ï¼Œç”Ÿæˆé•¿è¡¨å’Œç›®æ ‡å˜é‡
python prepare_tsfresh_input.py \
  --data-dir F:\stockdata\getDayKlineData\20241101-20250818-front \
  --single \
  --use-date \
  --out-long ../æ•°æ®æ–‡ä»¶/tsfresh_long.csv \
  --out-target ../æ•°æ®æ–‡ä»¶/tsfresh_target_panel.csv
```

**å‚æ•°è¯´æ˜ï¼š**
- `--data-dir`: åŸå§‹CSVæ•°æ®ç›®å½•
- `--single`: ä½¿ç”¨å•å˜é‡æ¨¡å¼ï¼ˆæ”¶ç›˜ä»·ï¼‰
- `--use-date`: ä½¿ç”¨dateåˆ—ä½œä¸ºæ—¶é—´è½´
- `--out-long`: é•¿è¡¨è¾“å‡ºæ–‡ä»¶
- `--out-target`: ç›®æ ‡å˜é‡è¾“å‡ºæ–‡ä»¶

### æ­¥éª¤3ï¼šå› å­æå–ä¸ICè®¡ç®—
```bash
# æ„å»ºæ»šåŠ¨çª—å£ï¼Œæå–å› å­å¹¶è®¡ç®—IC
python run_factor_ic.py \
  --long-csv ../æ•°æ®æ–‡ä»¶/tsfresh_long.csv \
  --target-csv ../æ•°æ®æ–‡ä»¶/tsfresh_target_panel.csv \
  --window 60 \
  --out-features ../æ•°æ®æ–‡ä»¶/window_features.csv \
  --out-ic ../ç»“æœæ–‡ä»¶/ic_scores.csv
```

**å‚æ•°è¯´æ˜ï¼š**
- `--long-csv`: é•¿è¡¨æ•°æ®æ–‡ä»¶
- `--target-csv`: ç›®æ ‡å˜é‡æ–‡ä»¶
- `--window`: æ»šåŠ¨çª—å£é•¿åº¦ï¼ˆäº¤æ˜“æ—¥ï¼‰
- `--out-features`: ç‰¹å¾çŸ©é˜µè¾“å‡ºæ–‡ä»¶
- `--out-ic`: ICè¯„åˆ†è¾“å‡ºæ–‡ä»¶

## ğŸ“Š æ•°æ®æ ¼å¼è¯´æ˜

### é•¿è¡¨æ ¼å¼ (tsfresh_long.csv)
```csv
id,time,value
000001.SZ,2024-11-01,11.068
000001.SZ,2024-11-04,11.098
...
```

### ç›®æ ‡å˜é‡æ ¼å¼ (tsfresh_target_panel.csv)
```csv
id,time,target
000001.SZ,2024-11-01,11.548
000001.SZ,2024-11-04,11.678
...
```
å…¶ä¸­targetä¸ºæœªæ¥20æ—¥æœ€é«˜æ”¶ç›˜ä»·ï¼ˆæ’é™¤å½“å¤©ï¼‰

### ç‰¹å¾çŸ©é˜µæ ¼å¼ (window_features.csv)
```csv
window_id,stock_id,anchor_time,feature1,feature2,...,target
000001.SZ|20241201,000001.SZ,2024-12-01,0.123,0.456,...,11.548
...
```

## ğŸ” æ ¸å¿ƒåŠŸèƒ½

### 1. æ•°æ®é¢„å¤„ç†
- æ”¯æŒå¤šè‚¡ç¥¨CSVæ•°æ®æ‰¹é‡å¤„ç†
- è‡ªåŠ¨è¿‡æ»¤åœç‰Œè®°å½•
- ç”Ÿæˆtsfreshå…¼å®¹çš„é•¿è¡¨æ ¼å¼
- è®¡ç®—æœªæ¥20æ—¥æœ€é«˜ä»·ä½œä¸ºé¢„æµ‹ç›®æ ‡

### 2. ç‰¹å¾æå–
- **tsfreshæ¨¡å¼**: ä½¿ç”¨tsfreshåº“æå–æ—¶é—´åºåˆ—ç‰¹å¾
- **å¢å¼ºæ¨¡å¼**: ä½¿ç”¨è‡ªç ”ç‰¹å¾æå–å™¨ï¼ˆæ— GPUä¾èµ–ï¼‰
- æ”¯æŒ45+ç§ç»Ÿè®¡ç‰¹å¾ï¼ˆè¶‹åŠ¿ã€æ³¢åŠ¨ã€å‘¨æœŸæ€§ç­‰ï¼‰

### 3. æ»šåŠ¨çª—å£
- æ„å»ºæ—¶é—´æ»šåŠ¨çª—å£è¿›è¡Œç‰¹å¾æå–
- çª—å£IDæ ¼å¼ï¼š`{stock_id}|{YYYYMMDD}`
- è‡ªåŠ¨å¯¹é½ç›®æ ‡å˜é‡

### 4. ICè¯„åˆ†
- è®¡ç®—Pearsonã€Spearmanã€Kendallä¸‰ç§ç›¸å…³ç³»æ•°
- ç”Ÿæˆç‰¹å¾é‡è¦æ€§æ’å
- å¯è§†åŒ–ICåˆ†å¸ƒå’Œç‰¹å¾é‡è¦æ€§

## ğŸ› ï¸ æ•…éšœæ’é™¤

### å¸¸è§é—®é¢˜

1. **tsfreshå®‰è£…å¤±è´¥**
   ```bash
   # ä½¿ç”¨å¢å¼ºç‰ˆç‰¹å¾æå–å™¨
   # è„šæœ¬ä¼šè‡ªåŠ¨å›é€€åˆ°enhanced_feature_extractor.py
   ```

2. **å†…å­˜ä¸è¶³**
   ```bash
   # å‡å°‘çª—å£é•¿åº¦
   --window 30
   
   # æˆ–åˆ†æ‰¹å¤„ç†æ•°æ®
   ```

3. **æ•°æ®æ ¼å¼é”™è¯¯**
   ```bash
   # æ£€æŸ¥CSVæ–‡ä»¶æ ¼å¼
   # ç¡®ä¿åŒ…å«å¿…è¦çš„åˆ—ï¼šdate/time, open, high, low, close, volume, amount
   ```

## ğŸ“ æ³¨æ„äº‹é¡¹

1. ç¡®ä¿è™šæ‹Ÿç¯å¢ƒå·²æ¿€æ´»
2. å¤§æ•°æ®é›†å¤„ç†éœ€è¦è¶³å¤Ÿå†…å­˜
3. é¦–æ¬¡è¿è¡Œå¯èƒ½éœ€è¦è¾ƒé•¿æ—¶é—´
4. å»ºè®®å…ˆåœ¨å°æ•°æ®é›†ä¸Šæµ‹è¯•

## ğŸ”— ç›¸å…³æ–‡æ¡£

- [tsfreshå®˜æ–¹æ–‡æ¡£](https://tsfresh.readthedocs.io/)
- [pandasæ—¶é—´åºåˆ—å¤„ç†](https://pandas.pydata.org/docs/user_guide/timeseries.html)
- [scipyç»Ÿè®¡åˆ†æ](https://docs.scipy.org/doc/scipy/reference/stats.html) 